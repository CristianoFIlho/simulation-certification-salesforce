<!DOCTYPE html>
<html>
<head>
    <title>Perguntas e Respostas</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="../_js/resposta.js"></script>
    <style>
        .correct-answer {
            color: green;
        }
        #justification {
            display: none;
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #questions-container {
            width: 100%;
            max-width: 600px;
        }
        .row {
            justify-content: center;
        }
    </style>
</head>
<body>
<div id="headerContainer"></div>
<script>
    // Chama a função getHeader() e insere o resultado no elemento com o id "headerContainer"
    document.getElementById("headerContainer").innerHTML = getHeader();
</script>
<div class="container">
    <div class="text-center mt-5">
        <h1>Configuration and Setup (Objectives 1-2) - Admin</h1>
    </div>
    <div id="questions-container" class="mt-3 list-group" style="border: 1px solid black; padding: 10px; text-align: left;"></div>
    <div class="row mt-3">
        <div class="col">
            <button id="previous-button" class="btn btn-primary" onclick="previousQuestion()">Anterior</button>
        </div>
        <div class="col text-center">
            <button class="btn btn-primary" onclick="checkAnswer()">Verificar Resposta</button>
        </div>
        <div class="col text-right">
            <button id="next-button" class="btn btn-primary" onclick="nextQuestion()">Próximo</button>
        </div>
    </div>

    <div class="references-container mt-3">
        <h2>Justificativa</h2>
        <p id="justification"></p>
        <h2>Links de Referência</h2>
        <ul id="reference-links"></ul>
    </div>

    <div class="screenshots-container mt-3">
        <h2>Capturas de Tela</h2>
        <img id="screenshot" src="" alt="Captura de Tela" class="img-fluid">
    </div>

    <div class="video-container mt-3 embed-responsive embed-responsive-16by9">
        <h2>Vídeo Explicativo</h2>
        <video id="video" controls class="embed-responsive-item"></video>
    </div>
</div>
</br>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Dados das perguntas e respostas em formato JSON
    var questionsData = questions();

    var currentQuestionIndex = 0;

    // Função para criar as perguntas e respostas
    function createQuestions() {
        var container = $("#questions-container");

        // Cria o elemento de pergunta
        var questionElement = $("<div>");
        questionElement.addClass("mt-3");
        questionElement.append("<p><strong>Question " + (currentQuestionIndex + 1) + ":</strong> " + questionsData[currentQuestionIndex].question + "</p>");

        // Cria os elementos de opções de resposta
        for (var j = 0; j < questionsData[currentQuestionIndex].options.length; j++) {
            var optionElement = $("<div>");
            optionElement.addClass("form-check mt-2");

            var inputElement = $("<input>");
            inputElement.addClass("form-check-input");
            inputElement.attr("type", questionsData[currentQuestionIndex].type);
            inputElement.attr("name", "question-" + currentQuestionIndex);
            inputElement.val(j);
            optionElement.append(inputElement);

            var labelElement = $("<label>");
            labelElement.addClass("form-check-label");
            labelElement.html(questionsData[currentQuestionIndex].options[j]);
            optionElement.append(labelElement);

            questionElement.append(optionElement);
        }

        // Adiciona a pergunta ao container
        container.html(questionElement);

        // Desabilita o botão "Anterior" se for a primeira pergunta
        if (currentQuestionIndex === 0) {
            $("#previous-button").hide();
        } else {
            $("#previous-button").show();
        }

        // Desabilita o botão "Próximo"
        $("#next-button").prop("disabled", true);

        // Esconde os containers de referências, capturas de tela e vídeo
        $(".references-container").hide();
        $(".screenshots-container").hide();
        $(".video-container").hide();
    }

    // Função para verificar a resposta atual e habilitar o botão "Próximo" se estiver correta
    function checkAnswer() {
        var answer = $("input[name='question-" + currentQuestionIndex + "']:checked").val();

        // Verifica se uma resposta foi selecionada
        if (answer === undefined) {
            alert("Por favor, selecione uma resposta.");
            return;
        }

        // Verifica se a resposta está correta
        if (questionsData[currentQuestionIndex].type === "radio") {
            if (parseInt(answer) === questionsData[currentQuestionIndex].correctAnswer) {
                // Resposta correta
                $("#justification").html(questionsData[currentQuestionIndex].justification);
                $("input[name='question-" + currentQuestionIndex + "']:checked + label").addClass("correct-answer");

                // Habilita o botão "Próximo"
                $("#next-button").prop("disabled", false);

                // Mostra os containers de referências, capturas de tela e vídeo
                if (questionsData[currentQuestionIndex].referenceLinks && questionsData[currentQuestionIndex].referenceLinks.length > 0) {
                    $(".references-container").show();
                }
                if (questionsData[currentQuestionIndex].screenshots && questionsData[currentQuestionIndex].screenshots.length > 0) {
                    $(".screenshots-container").show();
                }
                if (questionsData[currentQuestionIndex].videos && questionsData[currentQuestionIndex].videos.length > 0) {
                    $(".video-container").show();
                }

                // Atualiza os links de referência, captura de tela e vídeo
                var referenceLinks = questionsData[currentQuestionIndex].referenceLinks;
                var screenshot = questionsData[currentQuestionIndex].screenshots[Math.floor(Math.random() * questionsData[currentQuestionIndex].screenshots.length)];
                var video = questionsData[currentQuestionIndex].videos[Math.floor(Math.random() * questionsData[currentQuestionIndex].videos.length)];
                updateReferences(referenceLinks);
                updateScreenshot(screenshot);
                updateVideo(video);

                // Mostra um alerta com a resposta correta
                alert("Resposta correta!");
            } else {
                // Resposta incorreta
                alert("Resposta incorreta!");
            }
        } else if (questionsData[currentQuestionIndex].type === "checkbox") {
            var selectedOptions = [];
            $("input[name='question-" + currentQuestionIndex + "']:checked").each(function() {
                selectedOptions.push(parseInt($(this).val()));
            });

            if (arraysEqual(selectedOptions, questionsData[currentQuestionIndex].correctAnswer)) {
                // Resposta correta
                $("#justification").html(questionsData[currentQuestionIndex].justification);
                $("input[name='question-" + currentQuestionIndex + "']:checked + label").addClass("correct-answer");

                // Habilita o botão "Próximo"
                $("#next-button").prop("disabled", false);

                // Mostra os containers de referências, capturas de tela e vídeo
                if (questionsData[currentQuestionIndex].referenceLinks && questionsData[currentQuestionIndex].referenceLinks.length > 0) {
                    $(".references-container").show();
                }
                if (questionsData[currentQuestionIndex].screenshots && questionsData[currentQuestionIndex].screenshots.length > 0) {
                    $(".screenshots-container").show();
                }
                if (questionsData[currentQuestionIndex].videos && questionsData[currentQuestionIndex].videos.length > 0) {
                    $(".video-container").show();
                }

                // Atualiza os links de referência, captura de tela e vídeo
                var referenceLinks = questionsData[currentQuestionIndex].referenceLinks;
                var screenshot = questionsData[currentQuestionIndex].screenshots[Math.floor(Math.random() * questionsData[currentQuestionIndex].screenshots.length)];
                var video = questionsData[currentQuestionIndex].videos[Math.floor(Math.random() * questionsData[currentQuestionIndex].videos.length)];
                updateReferences(referenceLinks);
                updateScreenshot(screenshot);
                updateVideo(video);

                // Mostra um alerta com a resposta correta
                alert("Resposta correta!");
            } else {
                // Resposta incorreta
                alert("Resposta incorreta!");
            }
        }

        // Exibe a justificativa
        $("#justification").show();
    }

    // Função para comparar dois arrays
    function arraysEqual(arr1, arr2) {
        if (arr1.length !== arr2.length) {
            return false;
        }

        for (var i = 0; i < arr1.length; i++) {
            if (arr1[i] !== arr2[i]) {
                return false;
            }
        }

        return true;
    }

    // Função para avançar para a próxima pergunta
    function nextQuestion() {
        currentQuestionIndex++;

        // Armazena o valor de currentQuestionIndex no localStorage
        localStorage.setItem('currentQuestionIndex', currentQuestionIndex);

        // Verifica se ainda há perguntas a serem exibidas
        if (currentQuestionIndex < questionsData.length) {
            createQuestions();
        } else {
            // Todas as perguntas foram respondidas
            alert("Você respondeu todas as perguntas!");

            // Desabilita o botão "Próximo"
            $("#next-button").prop("disabled", true);
        }
    }

    // Função para voltar para a pergunta anterior
    function previousQuestion() {
        currentQuestionIndex--;

        // Armazena o valor de currentQuestionIndex no localStorage
        localStorage.setItem('currentQuestionIndex', currentQuestionIndex);

        // Verifica se ainda há perguntas anteriores
        if (currentQuestionIndex >= 0) {
            createQuestions();
        } else {
            // Já está na primeira pergunta
            alert("Esta é a primeira pergunta!");
        }
    }

    // Função para atualizar os links de referência
    function updateReferences(referenceLinks) {
        var referenceLinksList = $("#reference-links");
        referenceLinksList.empty();

        if (referenceLinks && referenceLinks.length > 0) {
            for (var i = 0; i < referenceLinks.length; i++) {
                var listItem = $("<li>");
                var linkElement = $("<a>");
                linkElement.attr("href", referenceLinks[i]);
                linkElement.attr("target", "_blank");
                linkElement.text("Exemplo " + (i + 1));
                listItem.append(linkElement);
                referenceLinksList.append(listItem);
            }
        }
    }

    // Função para atualizar a captura de tela
    function updateScreenshot(screenshot) {
        if (screenshot) {
            $("#screenshot").attr("src", screenshot);
        } else {
            $("#screenshot").attr("src", "");
        }
    }

    // Função para atualizar o vídeo
    function updateVideo(video) {
        if (video) {
            $("#video").attr("src", video);
        } else {
            $("#video").attr("src", "");
        }
    }

    // Verifica se há um valor armazenado no localStorage
    if (localStorage.getItem('currentQuestionIndex')) {
        // Recupera o valor armazenado e define currentQuestionIndex com esse valor
        currentQuestionIndex = parseInt(localStorage.getItem('currentQuestionIndex'));
    }

    // Chama a função para criar a primeira pergunta
    createQuestions();
</script>
<div id="footerContainer"></div>

<script>
    // Chama a função getHeader() e insere o resultado no elemento com o id "footerContainer"
    document.getElementById("footerContainer").innerHTML = getFooter();
</script>
</body>
</html>
